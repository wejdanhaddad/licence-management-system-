{% extends 'base.html.twig' %}

{% block title %}Nos Produits{% endblock %}

{% block body %}
<div class="container my-5">
    <h1 class="text-center text-primary fw-bold mb-4 display-5">Catalogue de Produits</h1>

    <div class="table-responsive shadow-lg rounded-4 overflow-hidden">
        <table class="table table-hover align-middle mb-0">
            <thead class="table-dark text-uppercase">
                <tr>
                    <th>#</th>
                    <th>Nom</th>
                    <th>Image</th>
                    <th>Description</th>
                    <th>Version</th>
                    <th>Licence</th>
                    <th>Créé le</th>
                    <th>Mis à jour</th>
                    <th>Statut</th>
                    <th>Prix</th>
                    {% if is_granted('ROLE_ADMIN') %}
                        <th>Actions</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for produit in produits %}
                    <tr class="table-row transition">
                        <td>{{ produit.id }}</td>
                        <td class="fw-semibold">{{ produit.name }}</td>
                        <td>
                            <img src="{{ asset('uploads/produits/' ~ produit.image) }}" 
                                 alt="{{ produit.name }}" 
                                 class="img-thumbnail border-0 shadow-sm" 
                                 style="max-width: 70px;">
                        </td>
                        <td class="text-muted">{{ produit.description|length > 50 ? produit.description|slice(0, 50) ~ '…' : produit.description }}</td>
                        <td>{{ produit.versionActuelle }}</td>
                        <td>{{ produit.typeLicence }}</td>
                        <td>{{ produit.dateCreation ? produit.dateCreation|date('d/m/Y') : '' }}</td>
                        <td>{{ produit.dateDerniereMiseAJour ? produit.dateDerniereMiseAJour|date('d/m/Y') : '' }}</td>
                        <td>
                            <span class="badge {{ produit.statut ? 'bg-success' : 'bg-danger' }}">
                                {{ produit.statut ? 'Actif' : 'Inactif' }}
                            </span>
                        </td>
                        <td class="fw-bold text-primary">{{ produit.prix }} €</td>
                        {% if is_granted('ROLE_CLIENT') %}
                            <td>
                                <div class="d-flex flex-wrap justify-content-center gap-2">
                                    <a href="{{ path('app_produit_show', {'id': produit.id}) }}" class="btn btn-outline-primary btn-sm rounded-pill">
                                        <i class="bi bi-eye"></i> Voir
                                    </a>
                                    <a href="{{ path('app_produit_edit', {'id': produit.id}) }}" class="btn btn-outline-success btn-sm rounded-pill">
                                        <i class="bi bi-pencil"></i> Modifier
                                    </a>
                                    <a href="{{ path('app_produit_delete', {'id': produit.id}) }}" 
                                       class="btn btn-outline-danger btn-sm rounded-pill"
                                       onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce produit ?');">
                                        <i class="bi bi-trash"></i> Supprimer
                                    </a>
                                </div>
                            </td>
                        {% endif %}
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="11" class="text-center text-muted py-4">Aucun produit trouvé.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% if is_granted('ROLE_ADMIN') %}
        <div class="text-center mt-5">
            <a href="{{ path('app_produit_new') }}" class="btn btn-info btn-lg rounded-pill shadow-sm">
                <i class="bi bi-plus-circle me-1"></i> Ajouter un produit
            </a>
        </div>
    {% endif %}
</div>

<style>
    .transition {
        transition: all 0.2s ease-in-out;
    }

    .table-row:hover {
        background-color: #f8f9fa;
        transform: scale(1.005);
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .badge.bg-success {
        background-color: #198754 !important;
    }

    .badge.bg-danger {
        background-color: #dc3545 !important;
    }
</style>
{% endblock %}
